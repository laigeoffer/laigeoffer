<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>服务网关 | 🚀来个offer</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="🚀来个 offer 民间开源实战项目聚集地，助力学生党和社招党拿到一个更好的 offer 💪🏻">
    <meta name="keywords" content="🚀来个 offer 民间开源实战项目聚集地，助力学生党和社招党拿到一个更好的 offer 💪🏻,Java，JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.d7ab4724.css" as="style"><link rel="preload" href="/assets/js/app.e2354821.js" as="script"><link rel="preload" href="/assets/js/2.9fe4c257.js" as="script"><link rel="preload" href="/assets/js/29.59cb1610.js" as="script"><link rel="prefetch" href="/assets/js/10.1b7ede1d.js"><link rel="prefetch" href="/assets/js/11.dfdf6f9a.js"><link rel="prefetch" href="/assets/js/12.03dd4eb7.js"><link rel="prefetch" href="/assets/js/13.9933faa8.js"><link rel="prefetch" href="/assets/js/14.e8aba069.js"><link rel="prefetch" href="/assets/js/15.6306f7ef.js"><link rel="prefetch" href="/assets/js/16.ac464ec9.js"><link rel="prefetch" href="/assets/js/17.d25cf749.js"><link rel="prefetch" href="/assets/js/18.1eca33ab.js"><link rel="prefetch" href="/assets/js/19.8d58e2ed.js"><link rel="prefetch" href="/assets/js/20.7e93654e.js"><link rel="prefetch" href="/assets/js/21.f0639e91.js"><link rel="prefetch" href="/assets/js/22.bc47cdb6.js"><link rel="prefetch" href="/assets/js/23.2b691974.js"><link rel="prefetch" href="/assets/js/24.845f650c.js"><link rel="prefetch" href="/assets/js/25.8534672e.js"><link rel="prefetch" href="/assets/js/26.b91e8634.js"><link rel="prefetch" href="/assets/js/27.68cf8b16.js"><link rel="prefetch" href="/assets/js/28.04779de3.js"><link rel="prefetch" href="/assets/js/3.991d9f81.js"><link rel="prefetch" href="/assets/js/30.6d16ba04.js"><link rel="prefetch" href="/assets/js/31.e35f52a7.js"><link rel="prefetch" href="/assets/js/32.885435af.js"><link rel="prefetch" href="/assets/js/33.d5b2b439.js"><link rel="prefetch" href="/assets/js/34.e1a190ee.js"><link rel="prefetch" href="/assets/js/35.d1aa436e.js"><link rel="prefetch" href="/assets/js/36.1f6a2dc3.js"><link rel="prefetch" href="/assets/js/37.489b687c.js"><link rel="prefetch" href="/assets/js/38.28544d15.js"><link rel="prefetch" href="/assets/js/39.0e2318e0.js"><link rel="prefetch" href="/assets/js/4.28f36990.js"><link rel="prefetch" href="/assets/js/40.59105aff.js"><link rel="prefetch" href="/assets/js/41.0dd9b29b.js"><link rel="prefetch" href="/assets/js/42.26472a4d.js"><link rel="prefetch" href="/assets/js/43.f1ffffb6.js"><link rel="prefetch" href="/assets/js/44.b3f8fa3f.js"><link rel="prefetch" href="/assets/js/45.43257546.js"><link rel="prefetch" href="/assets/js/46.a812f1bd.js"><link rel="prefetch" href="/assets/js/47.1cd38c6c.js"><link rel="prefetch" href="/assets/js/48.8093ec91.js"><link rel="prefetch" href="/assets/js/49.dcd37c80.js"><link rel="prefetch" href="/assets/js/5.46083734.js"><link rel="prefetch" href="/assets/js/50.dc35fde2.js"><link rel="prefetch" href="/assets/js/51.861aa30d.js"><link rel="prefetch" href="/assets/js/52.09175739.js"><link rel="prefetch" href="/assets/js/53.66f345de.js"><link rel="prefetch" href="/assets/js/54.bd228cf9.js"><link rel="prefetch" href="/assets/js/55.24791a79.js"><link rel="prefetch" href="/assets/js/56.b03d460f.js"><link rel="prefetch" href="/assets/js/57.51c5f8b5.js"><link rel="prefetch" href="/assets/js/58.b8df3c48.js"><link rel="prefetch" href="/assets/js/59.1fa18e61.js"><link rel="prefetch" href="/assets/js/6.ed8f9daa.js"><link rel="prefetch" href="/assets/js/60.6a75458d.js"><link rel="prefetch" href="/assets/js/61.6b63fa7a.js"><link rel="prefetch" href="/assets/js/62.f35e3bd9.js"><link rel="prefetch" href="/assets/js/63.b57ba237.js"><link rel="prefetch" href="/assets/js/64.4ef998d1.js"><link rel="prefetch" href="/assets/js/7.cc3ab64a.js"><link rel="prefetch" href="/assets/js/8.cabf289b.js"><link rel="prefetch" href="/assets/js/9.d555b3a2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d7ab4724.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="🚀来个offer" class="logo"> <span class="site-name can-hide">🚀来个offer</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端技术" class="dropdown-title"><a href="/technology/mq/" class="link-title">后端技术</a> <span class="title" style="display:none;">后端技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/technology/mq/" class="nav-link">消息队列</a></li><li class="dropdown-item"><!----> <a href="/pages/weifuwu/" class="nav-link">微服务</a></li><li class="dropdown-item"><!----> <a href="/pages/yunyuansheng/" class="nav-link">云原生</a></li><li class="dropdown-item"><!----> <a href="/pages/aigc/" class="nav-link">大模型&amp;AIGC</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🔥实战项目" class="dropdown-title"><a href="/project/laigeoffer/pmhub/about/" class="link-title">🔥实战项目</a> <span class="title" style="display:none;">🔥实战项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>校招实战项目</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/project/laigeoffer/pmhub/about/" class="nav-link">PmHub（智能项目管理平台）</a></li></ul></li><li class="dropdown-item"><h4>社招实战项目</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/laigeoffer/AutoCodeFlow/about/" class="nav-link">AutoCodeFlow（自动编码系统）</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="在线体验" class="dropdown-title"><!----> <span class="title" style="display:;">在线体验</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>校招实战项目</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://pmhub.laigeoffer.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  PmHub（智能项目管理平台）
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>社招实战项目</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://pmhub.laigeoffer.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  AutoCodeFlow（自动编码系统）
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><a href="/laigeoffer/studygroupabout/" class="nav-link">🌈加入学习群</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="珍藏资源" class="dropdown-title"><!----> <span class="title" style="display:;">珍藏资源</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/resource/pdftoc/" class="nav-link">⬇️PDF下载</a></li><li class="dropdown-item"><!----> <a href="/pages/pojieheji/" class="nav-link">🔓破解合集</a></li></ul></div></div> <a href="https://github.com/laigeoffer" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端技术" class="dropdown-title"><a href="/technology/mq/" class="link-title">后端技术</a> <span class="title" style="display:none;">后端技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/technology/mq/" class="nav-link">消息队列</a></li><li class="dropdown-item"><!----> <a href="/pages/weifuwu/" class="nav-link">微服务</a></li><li class="dropdown-item"><!----> <a href="/pages/yunyuansheng/" class="nav-link">云原生</a></li><li class="dropdown-item"><!----> <a href="/pages/aigc/" class="nav-link">大模型&amp;AIGC</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🔥实战项目" class="dropdown-title"><a href="/project/laigeoffer/pmhub/about/" class="link-title">🔥实战项目</a> <span class="title" style="display:none;">🔥实战项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>校招实战项目</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/project/laigeoffer/pmhub/about/" class="nav-link">PmHub（智能项目管理平台）</a></li></ul></li><li class="dropdown-item"><h4>社招实战项目</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/laigeoffer/AutoCodeFlow/about/" class="nav-link">AutoCodeFlow（自动编码系统）</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="在线体验" class="dropdown-title"><!----> <span class="title" style="display:;">在线体验</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>校招实战项目</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://pmhub.laigeoffer.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  PmHub（智能项目管理平台）
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>社招实战项目</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://pmhub.laigeoffer.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  AutoCodeFlow（自动编码系统）
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><a href="/laigeoffer/studygroupabout/" class="nav-link">🌈加入学习群</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="珍藏资源" class="dropdown-title"><!----> <span class="title" style="display:;">珍藏资源</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/resource/pdftoc/" class="nav-link">⬇️PDF下载</a></li><li class="dropdown-item"><!----> <a href="/pages/pojieheji/" class="nav-link">🔓破解合集</a></li></ul></div></div> <a href="https://github.com/laigeoffer" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>项目介绍</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/project/laigeoffer/pmhub/about/" class="sidebar-link">什么是PmHub</a></li><li><a href="/pages/281398/" class="sidebar-link">校招更适合PmHub</a></li><li><a href="/pages/8023f6/" class="sidebar-link">技术架构选型</a></li><li><a href="/pages/c87b88/" class="sidebar-link">接口文档</a></li><li><a href="/pages/621292/" class="sidebar-link">产品原型</a></li><li><a href="/pages/97c74a/" class="sidebar-link">用户手册</a></li><li><a href="/pages/99dc82/" class="sidebar-link">如何学习PmHub</a></li><li><a href="/pages/d16cde/" class="sidebar-link">如何将PmHub写进简历</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>快速开始</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/8abf04/" class="sidebar-link">环境搭建</a></li><li><a href="/pages/94fcd5/" class="sidebar-link">AutoCodeFlow</a></li><li><a href="/pages/083160/" class="sidebar-link">快速启动（前端）</a></li><li><a href="/pages/0f1eb7/" class="sidebar-link">部署系统</a></li><li><a href="/pages/d667c4/" class="sidebar-link">Nginx配置</a></li><li><a href="/pages/ecde48/" class="sidebar-link">常见问题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>微服务</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/59af76/" aria-current="page" class="active sidebar-link">服务网关</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/59af76/#为什么需要网关" class="sidebar-link">为什么需要网关</a></li><li class="sidebar-sub-header level2"><a href="/pages/59af76/#网关选型" class="sidebar-link">网关选型</a></li><li class="sidebar-sub-header level2"><a href="/pages/59af76/#gateway-三大核心" class="sidebar-link">Gateway 三大核心</a></li></ul></li><li><a href="/pages/22f4fa/" class="sidebar-link">认证中心</a></li><li><a href="/pages/e61cfc/" class="sidebar-link">注册中心</a></li><li><a href="/pages/40df0f/" class="sidebar-link">配置中心</a></li><li><a href="/pages/dd19e3/" class="sidebar-link">。服务调用</a></li><li><a href="/pages/37cc8a/" class="sidebar-link">服务监控</a></li><li><a href="/pages/e9f5a5/" class="sidebar-link">系统服务</a></li><li><a href="/pages/f08aeb/" class="sidebar-link">链路追踪</a></li><li><a href="/pages/2caa78/" class="sidebar-link">分库分表</a></li><li><a href="/pages/e767b7/" class="sidebar-link">熔断和降级</a></li><li><a href="/pages/2b8d79/" class="sidebar-link">分布式事务</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>面试系列</span> <!----></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>面试常见问题解答</span> <!----></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>常见问题Q&amp;A</span> <!----></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>更新日志</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/b5c597/" class="sidebar-link">V1.0.0</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=PmHub" title="分类" data-v-06225672>PmHub</a></li><li data-v-06225672><a href="/categories/?category=%E5%BE%AE%E6%9C%8D%E5%8A%A1" title="分类" data-v-06225672>微服务</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/freestylefly" target="_blank" title="作者" class="beLink" data-v-06225672>苍何</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-05-21</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><!---->服务网关<!----></h1>  <div class="theme-vdoing-content content__default"><p>大家好呀，我是苍何。</p> <p>这年头，大家都在开始卷简历了，我也看了很多同学的简历，其中有一个同学的简历，我印象最为深刻，他的项目经历中，写了<strong>自定义 Gateway 过滤器实现统计接口调用耗时</strong>，我瞬间就来兴趣了~</p> <p>要知道利用微服务中的网关过滤器能力来统计接口调用耗时情况，其落地项目和设计思路是很考察对微服务架构整体掌握程度的。</p> <p>那今天我们就来重点看一看微服务中的网关吧，还是以 PmHub 项目实践深入展开。</p> <h2 id="为什么需要网关"><a href="#为什么需要网关" class="header-anchor">#</a> 为什么需要网关</h2> <p>网关我觉得可以理解成是微服务系统的<strong>门卫</strong>，是微服务架构中一个关键的组件，负责管理和调控外部请求进入内部微服务的流量。为了更好理解，拿个生活中的例子来对比下：</p> <p>一个大型的购物中心（微服务系统），里面有很多不同的商店（不同的微服务），比如服装店、餐馆、电影院等等。每个商店都有自己<strong>独立的入口</strong>，这样的好处是每个商店都可以独立运营。但是，如果每个顾客都直接去商店入口没有<strong>统一入口</strong>，会非常混乱。</p> <p>而且，购物中心需要对每个商店的顾客流量进行管理，比如防止某些商店人满为患或者统一处理会员优惠等。</p> <p><img src="https://cdn.tobebetterjavaer.com/stutymore/1716514349560-fbd5628f-43a0-42f5-962e-eb29a141c7ef.webp" alt="大型购物中心" title="大型购物中心"></p> <p>网关在微服务体系中的具体位置在哪儿呢？</p> <p><img src="https://cdn.tobebetterjavaer.com/stutymore/1716514447640-d34b7f90-60db-4676-8d1f-58ce97e4d826.png" alt="网关的位置" title="网关的位置"></p> <p>可以看到，网关在负载均衡下的第一入口，也就是说，整个微服务系统，外部请求都必须要经过网关，可以说是整个系统的<strong>门卫</strong>了。那网关具体负责哪些呢？</p> <p><img src="https://cdn.tobebetterjavaer.com/stutymore/1716515684720-db4fe2e3-f2c0-424f-b5c9-a02e12f904e8.png" alt="网关能干嘛" title="网关能干嘛"></p> <p>总结来说，微服务的应用可能部署在不同机房，不同地区，不同域名下。此时客户端（浏览器/手机/软件工具）想要请求对应的服务，都需要知道机器的具体 IP 或者域名 URL，当微服务实例众多时，这是非常难以记忆的，对 于客户端来说也太复杂难以维护。</p> <p>此时就有了网关，客户端相关的请求直接发送到网关，由网关根据请求标识解析判断出具体的微服务地址，再把请求转发到微服务实例。这其中的<strong>记忆功能</strong>就全部交由网关来操作了。</p> <h2 id="网关选型"><a href="#网关选型" class="header-anchor">#</a> 网关选型</h2> <p>Cloud 全家桶中有个很重要的组件就是网关，在 1.x 版本中都是采用的 Zuul 网关；但在 2.x 版本中，Zuul 的升级一直<strong>跳票</strong>，SpringCloud 最后自己研发了一个网关 SpringCloud Gateway 替代 Zuul。所以新项目，我们就别再去用 Zuul 了，简历上也最好以 Gateway 为主。</p> <p>所以目前用的主流的网关就是 SpringCloud Gateway 替代 Zuul 1.x 版网关。PmHub 中采用的也是自建 SpringCloud Gateway 的方式。</p> <h3 id="spring-cloud-gateway"><a href="#spring-cloud-gateway" class="header-anchor">#</a> Spring Cloud Gateway</h3> <p>Spring Cloud Gateway是基于 Spring 生态系统之上构建的 API 网关，包括：Spring 5.x，Spring Boot 2.x 和 Project Reactor。Spring Cloud Gateway 旨在提供一种简单而有效的方法来路由到 API，并为它们提供跨领域的关注点，例如：<strong>安全性，监视/指标，限流</strong>等。</p> <p>以下是官方原理图：</p> <p><img src="https://cdn.tobebetterjavaer.com/stutymore/1716516448626-db141bf3-6e47-41cb-ad56-ba122204c2a1.png" alt="gateway How It Works" title="gateway How It Works"></p> <h2 id="gateway-三大核心"><a href="#gateway-三大核心" class="header-anchor">#</a> Gateway 三大核心</h2> <p>看官网介绍可知，Spring Cloud Gateway 三大核心组件分别是<strong>路由</strong>（Route）、<strong>断言</strong>（Predicate）、<strong>过滤器</strong>（Filter），构成了网关的必要功能。</p> <p><img src="https://cdn.tobebetterjavaer.com/stutymore/1716521519061-8b8291cb-1f8c-4e01-ae90-394326edb602.png" alt="官网关于Spring Cloud Gateway三大组件" title="官网关于Spring Cloud Gateway三大组件"></p> <p>web 前端请求，通过一些匹配条件，定位到真正的服务节点。并在这个转发过程的前后，进行一些精细化控制。</p> <p>predicate就是我们的匹配条件。</p> <p>filter，就可以理解为一个无所不能的拦截器。有了这两个元素，再加上目标uri，就可以实现一个具体的路由了。</p> <p><img src="https://cdn.tobebetterjavaer.com/stutymore/1716521499393-41d26ced-d279-4106-895a-76b0601a68cf.png" alt="三大核心组件" title="三大核心组件"></p> <h3 id="路由-route"><a href="#路由-route" class="header-anchor">#</a> 路由（Route）</h3> <p>路由是构建网关的基本模块，它由 ID，目标 URI，一系列的断言和过滤器组成，如果断言为 true 则匹配该路由。</p> <p>在 PmHub 中网关的路由配置如下：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">locator</span><span class="token punctuation">:</span>
          <span class="token key atrule">lowerCaseServiceId</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
          <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token comment"># 认证中心</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pmhub<span class="token punctuation">-</span>auth
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//pmhub<span class="token punctuation">-</span>auth
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/auth/<span class="token important">**</span>
          <span class="token key atrule">filters</span><span class="token punctuation">:</span>
            <span class="token comment"># 验证码处理</span>
            <span class="token punctuation">-</span> CacheRequestFilter
           <span class="token comment"># - ValidateCodeFilter</span>
            <span class="token punctuation">-</span> StripPrefix=1
        <span class="token comment"># 代码生成</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pmhub<span class="token punctuation">-</span>gen
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//pmhub<span class="token punctuation">-</span>gen
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/gen/<span class="token important">**</span>
          <span class="token key atrule">filters</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> StripPrefix=0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>拿认证中心服务来说，id 取的就是 auth 在 nacos 注册的服务名，这样，请求网关的 URL 中带有「/auth/**」的请求都会被转发到认证中心这个服务上来。</p> <p>在spring cloud gateway中配置uri有三种方式，包括</p> <h4 id="websocket配置方式"><a href="#websocket配置方式" class="header-anchor">#</a> websocket配置方式</h4> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pmhub<span class="token punctuation">-</span>api
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> ws<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>9090/
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/api/<span class="token important">**</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="http地址配置方式"><a href="#http地址配置方式" class="header-anchor">#</a> http地址配置方式</h4> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pmhub<span class="token punctuation">-</span>api
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>9090/
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/api/<span class="token important">**</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="注册中心配置方式"><a href="#注册中心配置方式" class="header-anchor">#</a> 注册中心配置方式</h4> <p>其中 PmHub 中采用的是这种通过 Nacos 配置中心的配置方式。</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pmhub<span class="token punctuation">-</span>api
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//ruoyi<span class="token punctuation">-</span>api
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/api/<span class="token important">**</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="断言-predicate"><a href="#断言-predicate" class="header-anchor">#</a> 断言（Predicate）</h3> <p>断言可以理解为是<strong>匹配规则</strong>，比如在 PmHub 中配置的「 - Path=/auth/**」就代表所有符合这个路径的规则都会被转发到对应的服务上面来。可以看下官网介绍：</p> <p><img src="https://cdn.tobebetterjavaer.com/stutymore/1716525685437-192770a2-7bac-4f45-b5cb-8e4e1d3b1bca.png" alt="官网关于断言介绍" title="官网关于断言介绍">
简而言之，Predicate 就是为了实现一组匹配规则，让请求过来找到对应的Route 进行处理。</p> <p>Spring Cloud Gateway 创建 Route 对象时， 使用RoutePredicateFactory 创建 Predicate 对象，Predicate 对象可以赋值给Route。</p> <ul><li>Spring Cloud Gateway包含许多内置的Route Predicate Factories。</li> <li>所有这些断言都匹配 HTTP 请求的不同属性。</li> <li>多个Route Predicate Factories可以通过逻辑与（and）结合起来一起使用。</li></ul> <p>路由断言工厂 RoutePredicateFactory 包含的主要实现类如图所示，包括Datetime、请求的远端地址、路由权重、请求头、Host 地址、请求方法、请求路径和请求参数等类型的路由断言。</p> <p><img src="https://cdn.tobebetterjavaer.com/stutymore/1716526492684-86556361-5100-4172-946b-e5f825979b3d.png" alt="RoutePredicateFactory 整体架构" title="RoutePredicateFactory 整体架构"></p> <p>当然了除了我们定义的规则，也是可以支持一下路由规则的自定义的，以下是一些常用的断言。</p> <h4 id="weight-匹配权重"><a href="#weight-匹配权重" class="header-anchor">#</a> Weight-匹配权重</h4> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span> 
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> pmhub<span class="token punctuation">-</span>gateway
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pmhub<span class="token punctuation">-</span>system<span class="token punctuation">-</span>a
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>9201/
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Weight=group1<span class="token punctuation">,</span> <span class="token number">8</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pmhub<span class="token punctuation">-</span>system<span class="token punctuation">-</span>b
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>9201/
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Weight=group1<span class="token punctuation">,</span> <span class="token number">2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="datetime-匹配日期时间之后发生的请求"><a href="#datetime-匹配日期时间之后发生的请求" class="header-anchor">#</a> Datetime-匹配日期时间之后发生的请求</h4> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span> 
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> pmhub<span class="token punctuation">-</span>gateway
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pmhub<span class="token punctuation">-</span>system
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>9201/
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> After=2021<span class="token punctuation">-</span>02<span class="token punctuation">-</span>23T14<span class="token punctuation">:</span>20<span class="token punctuation">:</span>00.000+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="query-匹配查询参数"><a href="#query-匹配查询参数" class="header-anchor">#</a> Query-匹配查询参数</h4> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span> 
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> pmhub<span class="token punctuation">-</span>gateway
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pmhub<span class="token punctuation">-</span>system
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>9201/
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Query=username<span class="token punctuation">,</span> abc.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="path-匹配请求路径"><a href="#path-匹配请求路径" class="header-anchor">#</a> Path-匹配请求路径</h4> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span> 
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> pmhub<span class="token punctuation">-</span>gateway
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pmhub<span class="token punctuation">-</span>system
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>9201/
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/system/<span class="token important">**</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="header-匹配具有指定名称的请求头"><a href="#header-匹配具有指定名称的请求头" class="header-anchor">#</a> Header-匹配具有指定名称的请求头，</h4> <p>\d+值匹配正则表达式</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span> 
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> pmhub<span class="token punctuation">-</span>gateway
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> pmhub<span class="token punctuation">-</span>system
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>9201/
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Header=X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>Id<span class="token punctuation">,</span> \d+
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>当然了，内置的模板不满足需求，也是可以<strong>自定义断言规则</strong>的，方法也比较简单，按照以下套路即可：</p> <ul><li>要么继承 AbstractRoutePredicateFactory 抽象类</li> <li>要么实现 lRoutePredicateFactory:接口</li> <li>类开头任意取名，但是必须以 RoutePredicateFactory 后缀结尾</li></ul> <p>如下代码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * @auther canghe
 * @create 2024-05-23 18:30
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRoutePredicateFactory</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractRoutePredicateFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyRoutePredicateFactory<span class="token punctuation">.</span>Config</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">MyRoutePredicateFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token class-name">MyRoutePredicateFactory<span class="token punctuation">.</span>Config</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Validated</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Config</span><span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Setter</span>
        <span class="token annotation punctuation">@Getter</span>
        <span class="token annotation punctuation">@NotEmpty</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> userType<span class="token punctuation">;</span> <span class="token comment">//钻、金、银等用户等级</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerWebExchange</span><span class="token punctuation">&gt;</span></span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">MyRoutePredicateFactory<span class="token punctuation">.</span>Config</span> config<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerWebExchange</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> serverWebExchange<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">//检查request的参数里面，userType是否为指定的值，符合配置就通过</span>
                <span class="token class-name">String</span> userType <span class="token operator">=</span> serverWebExchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueryParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFirst</span><span class="token punctuation">(</span><span class="token string">&quot;userType&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>userType <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

                <span class="token comment">//如果说参数存在，就和config的数据进行比较</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>userType<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">getUserType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><h3 id="过滤器-filter"><a href="#过滤器-filter" class="header-anchor">#</a> 过滤器（Filter）</h3> <p>网关中的过滤器，有点类似 SpringMVC 里面的拦截器 Interceptor 以及 Servlet 的过滤器，其中「pre」 和「post」分别会在请求被执行钱调用和被执行后调用，用来修改请求和响应信息。</p> <p>过滤器也是面试中最常问的知识点，比如<strong>记录接口调用市场统计、限流、黑白名单等。</strong></p> <p>因文章篇幅有限，将在下一章单独细说细说，可见其重要程度了，也是 PmHub 项目框架的核心之一了。感兴趣可以持续关注。</p></div></div>  <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2024/05/24, 18:08:19</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/ecde48/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">常见问题</div></a> <a href="/pages/22f4fa/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">认证中心</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/ecde48/" class="prev">常见问题</a></span> <span class="next"><a href="/pages/22f4fa/">认证中心</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="canghe0818@gmain.con" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/laigeoffer" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2024-2024
    <span><a href="https://github.com/laigeoffer" target="_blank">laigeoffer</a> | <a href="https://github.com/laigeoffer" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e2354821.js" defer></script><script src="/assets/js/2.9fe4c257.js" defer></script><script src="/assets/js/29.59cb1610.js" defer></script>
  </body>
</html>
