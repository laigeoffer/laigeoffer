---
title: äº‘å®¹å™¨éƒ¨ç½²ç³»ç»Ÿ
date: 2024-05-21 06:53:47
permalink: /pages/0f1eb7/
categories: 
  - PmHub
  - å¿«é€Ÿå¼€å§‹
tags: 
  - null
author: 
  name: è‹ä½•
  link: https://github.com/freestylefly
requiresAuth: false
---

é‡‡ç”¨çš„æ˜¯ docker-compose éƒ¨ç½²ï¼Œéƒ¨ç½²æ­¥éª¤å¦‚ä¸‹ï¼š


## æœ¬åœ°å‡†å¤‡

å› æœåŠ¡å™¨æ„å»ºå¤ªè€—è´¹èµ„æºï¼Œæ‰€ä»¥å¯ä»¥æœ¬åœ°æ„å»ºå‰ç«¯èµ„æºåä¸Šä¼ åˆ°è¿œç¨‹ã€‚

```bash
npm run build:prod
```

## ä¸‹è½½é¡¹ç›®

```java
git clone git@github.com:laigeoffer/pmhub.git

# è¿›å»ç›®å½•
cd /è¿™é‡Œæ˜¯ä½ çš„ä¸‹è½½ç›®å½•/pmhub-cloud/

```

## æ‰“åŒ…æ„å»ºé¡¹ç›®

```bash
# åˆ‡æ¢åˆ°ç›®å½•
cd /è¿™é‡Œæ˜¯ä½ çš„ä¸‹è½½ç›®å½•/pmhub-cloud/pmhub
# åŒ…æ„å»ºé¡¹ç›®
mvn -T 1C clean package -Dmaven.test.skip=true -Dmaven.compile.fork=true

```

## é˜¿é‡Œäº‘å¼€å¯å®‰å…¨ç»„

![image.png](https://cdn.tobebetterjavaer.com/stutymore/1716722906304-d6f071f4-daa4-4eec-b7b0-dbda24ddfa29.png)



## æ‹·è´ jar åŒ…

å¯ä»¥ä¸Šä¼  jar åˆ°æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æœåŠ¡å™¨ä¸Šæ„å»ºåæ‰§è¡Œ

```bash
# å»dockerç›®å½•
cd /è¿™é‡Œæ˜¯ä½ çš„ä¸‹è½½ç›®å½•/pmhub-cloud/pmhub/docker

# æ‰§è¡Œæ‹·è´
sh copy.sh

```

## å¼€å¯æœåŠ¡å™¨é˜²ç«å¢™

```bash
 sh deploy.sh port

# æŸ¥çœ‹é˜²ç«å¢™æ˜¯å¦å¼€å¯
ufw status
```

## å¯åŠ¨åŸºç¡€ç¯å¢ƒ

```bash
# è¿›å»ç›®å½•
cd /è¿™é‡Œæ˜¯ä½ çš„ä¸‹è½½ç›®å½•/pmhub-cloud/pmhub/docker

# å¯åŠ¨åŸºç¡€ç¯å¢ƒï¼ˆå¿…é¡»ï¼‰
sh deploy.sh base
```




::: danger
æ¯ä¸€ä¸ªå¾®æœåŠ¡å¯åŠ¨éƒ½æ¯”è¾ƒè€—è´¹èµ„æºï¼Œå¦‚æœèµ„æºä¸å¤Ÿçš„å¯ä»¥å•ä¸ªå•ä¸ªå¯åŠ¨ï¼Œå…¶ä¸­æ‰§è¡Œ sh deploy.sh base çš„å†…éƒ¨å‘½ä»¤ä¸ºï¼š
```bash
# å¯åŠ¨åŸºç¡€ç¯å¢ƒï¼ˆå¿…é¡»ï¼‰åˆ†åˆ«å¯åŠ¨ MySQLã€Redisã€nacos å®¹å™¨
base(){
	docker-compose up -d pmhub-mysql pmhub-redis pmhub-nacos
}

```
:::



::: warning
ğŸ‘Š nacos çš„é…ç½®ä¸­çš„ MySQL è¦ç”¨å®¹å™¨å†…éƒ¨ç«¯å£ 3306ï¼Œè€Œä¸åº”è¯¥æ˜¯å®¿ä¸»æœºæ˜ å°„ç«¯å£ã€‚
è®¿é—® nacosï¼š[http://ä½ çš„æœåŠ¡å™¨åœ°å€:8848/nacos](http://ä½ çš„æœåŠ¡å™¨åœ°å€:8848/nacos)
ç”¨æˆ·åï¼šnacos
å¯†ç ï¼šä½ è®¾ç½®çš„å¯†ç 


nacos é»˜è®¤ä¸å¼€å¯é‰´æƒï¼Œéœ€è¦å•ç‹¬å¼€å¯é‰´æƒï¼Œå…·ä½“çœ‹é…ç½®æ–‡ä»¶
è¿›å…¥å®¹å™¨ï¼š docker exec -it pmhub-nacos /bin/bash 
é…ç½®æ›´æ–°éœ€è¦å…ˆ stop å®¹å™¨ï¼Œç„¶åé‡æ–°ç”¨ docker-compose é‡æ–°å¯åŠ¨
:::
docker exec -it pmhub-gateway /bin/bash 


## å¯åŠ¨ç½‘å…³å’Œè®¤è¯ä¸­å¿ƒ

```bash

# è¿›å»ç›®å½•
cd /è¿™é‡Œæ˜¯ä½ çš„ä¸‹è½½ç›®å½•/pmhub-cloud/pmhub/docker

# å¯åŠ¨
sh deploy.sh important

# æŸ¥çœ‹æ˜¯å¦å¯åŠ¨
docker ps

# æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
docker logs pmhub-gateway


```

![image.png](https://cdn.tobebetterjavaer.com/stutymore/1716735254077-c38e63e1-61b5-4928-87b0-783426b70c8b.png)

:::warning
é‡æ–°æ„å»ºï¼š
 docker-compose build --no-cache 
:::

## å¯åŠ¨åº”ç”¨æœåŠ¡

```bash
# ä¼šä¾æ¬¡å¯åŠ¨ pmhub-system pmhub-project pmhub-workflow
sh deploy.sh modules
```

## nginx å¯åŠ¨

Nginx æˆ‘å»ºè®®ä¸è¦ç”¨ docker å®‰è£…

```java
cd /etc/nginx/nginx.conf
```

```bash
# 1ã€æ£€æŸ¥é…ç½®æ˜¯å¦æ­£ç¡®
nginx -t

# 2ã€ä½¿é…ç½®ç”Ÿæ•ˆ
nginx -s reload

# 3ã€é‡å¯
systemctl restart nginx

# 4ã€æŸ¥çœ‹NginxçŠ¶æ€
systemctl status nginx

# 5ã€æŸ¥è¯¢Nginxè¿›ç¨‹ï¼š
ps -ef | grep nginx
æŸ¥çœ‹è¿›ç¨‹id
ps -C nginx -o pid

```

```bash
# è¿›å…¥Nginxé…ç½®ç›®å½•
cd /etc/nginx/vhosts
```

ä¿®æ”¹ Nginx æ–‡ä»¶ä¸­çš„å‰ç«¯åœ°å€

```bash
/è¿™é‡Œæ˜¯ä½ çš„ä¸‹è½½ç›®å½•/pmhub-cloud/pmhub/docker/nginx/html/dist

```

::: tip
å¦‚æœç”¨dockerå¯åŠ¨ä¸€ç›´æœ‰é—®é¢˜ï¼Œä¹Ÿå¯ä»¥è¯•è¯•ç”¨ jar åŒ…çš„æ–¹å¼å¯åŠ¨ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ·»åŠ è‹ä½•å¾®ä¿¡ï¼Œåœ¨ç¾¤é‡Œé¢å¤§å®¶ä¸€èµ·äº¤æµã€‚
:::

## ç”¨ jar åŒ…æ–¹å¼ä¾æ¬¡å¯åŠ¨

::: warning
æ³¨æ„ï¼š
è¿™ä¸ªç”¨ jar åŒ…æ–¹å¼å¯åŠ¨ï¼Œå¦‚æœç»ˆç«¯å…³é—­ï¼Œå¯¹åº”çš„æœåŠ¡ä¹Ÿä¼šåœæ­¢ã€‚
éœ€è¦éœ€è¦ç”¨ docker æ–¹å¼
:::

1ã€pmhub-gateway

```bash
# å®šä½åˆ°jarç›®å½•
cd /è¿™é‡Œæ˜¯ä½ çš„ä¸‹è½½ç›®å½•/pmhub-cloud/pmhub/docker/pmhub/gateway/jar

# åå°å¯åŠ¨
java -jar pmhub-gateway.jar & 

# æŸ¥çœ‹æ˜¯å¦å¯åŠ¨
netstat -tuln | grep 6880
æˆ–è€…
ps aux | grep pmhub-gateway.jar

# å¦‚ä½•å…³é—­æœåŠ¡
kill 12345

```

2ã€å¯åŠ¨ pmhub-auth

```bash
# å®šä½åˆ°jarç›®å½•
cd /è¿™é‡Œæ˜¯ä½ çš„ä¸‹è½½ç›®å½•/pmhub-cloud/pmhub/docker/pmhub/auth/jar

# åå°å¯åŠ¨
java -jar pmhub-auth.jar & 

# æŸ¥çœ‹æ˜¯å¦å¯åŠ¨
ps aux | grep pmhub-auth.jar


```

å¦‚æœå¯åŠ¨æŠ¥é”™ï¼Œå¤§æ¦‚ç‡æ˜¯ nacos é‰´æƒé—®é¢˜å¯¼è‡´ï¼Œéœ€è¦ä¿®æ”¹æ–‡ä»¶é‡æ–°æ„å»º
å‚è€ƒå…¶é…ç½®ï¼š/è¿™é‡Œæ˜¯ä½ çš„ä¸‹è½½ç›®å½•/pmhub-cloud/pmhub/pmhub-gateway/src/main/resources

![image.png](https://cdn.tobebetterjavaer.com/stutymore/1716804163147-2468eece-dd3d-4dc0-aa29-bd8e86770954.png)


å¦‚ä½•è®© nacos å¼€å¯æœåŠ¡é—´ä¸ç”¨é‰´æƒåŠŸèƒ½å› ç‰ˆæœ¬é—®é¢˜è¿˜åœ¨å®Œå–„ä¸­

3ã€å¯åŠ¨ pmhub-system

```bash
# å®šä½åˆ°jarç›®å½•
cd /è¿™é‡Œæ˜¯ä½ çš„ä¸‹è½½ç›®å½•/pmhub-cloud/pmhub/docker/pmhub/modules/system/jar

# åå°å¯åŠ¨
java -jar pmhub-system.jar & 

# æŸ¥çœ‹æ˜¯å¦å¯åŠ¨
ps aux | grep pmhub-system.jar


```

4ã€å¯åŠ¨ pmhub-project

```bash
# å®šä½åˆ°jarç›®å½•
cd /è¿™é‡Œæ˜¯ä½ çš„ä¸‹è½½ç›®å½•/pmhub-cloud/pmhub/docker/pmhub/modules/project/jar

# åå°å¯åŠ¨
java -jar pmhub-project.jar & 

# æŸ¥çœ‹æ˜¯å¦å¯åŠ¨
ps aux | grep pmhub-project.jar


```

4ã€å¯åŠ¨ pmhub-workflow

```bash
# å®šä½åˆ°jarç›®å½•
cd /è¿™é‡Œæ˜¯ä½ çš„ä¸‹è½½ç›®å½•/pmhub-cloud/pmhub/docker/pmhub/modules/workflow/jar

# åå°å¯åŠ¨
java -jar pmhub-workflow.jar & 

# æŸ¥çœ‹æ˜¯å¦å¯åŠ¨
ps aux | grep pmhub-workflow.jar

```
